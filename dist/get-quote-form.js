"use strict";(()=>{document.addEventListener("DOMContentLoaded",function(){let a=document.querySelectorAll(".form-block-wrapper"),p=document.querySelector(".next-get-quote"),g=document.querySelector(".go-back-get-quote"),f=document.querySelector(".submit-get-quote"),k=["gmail.com","yahoo.com","hotmail.com","outlook.com"],r=document.querySelectorAll(".last-step"),y=document.querySelectorAll(".switch-to-biz"),i=0,l=!1,v=!1,S="https://backend-eoqisywzm-mohammed-hafeezs-projects.vercel.app/api/hubspot";function E(e){let s=document.querySelector(".loading-indicator"),o=document.querySelector(".submit-text"),t=document.querySelector(".loader-gq");s&&(s.style.display=e?"block":"none"),o&&t&&(e?(o.classList.add("hidden"),t.classList.remove("hidden")):(o.classList.remove("hidden"),t.classList.add("hidden")))}function q(){if(!l){console.log("Skipping setting nil options for free email.");return}let e=document.getElementById("company_registration_type_gq");e&&e.value.trim()===""&&(h(e),e.value="nil");let s=document.querySelector('input[type="radio"][value="nil"]');s&&(s.checked=!0);let o=document.getElementById("industry_gq");o&&o.value.trim()===""&&(h(o),o.value="nil"),i===2&&a[2].querySelectorAll("select[name], input[name], textarea[name]").forEach(n=>{if(n.tagName==="SELECT"&&n.value.trim()==="")h(n),n.value="nil";else if(n.type==="radio"&&!a[2].querySelector(`input[name="${n.name}"]:checked`)){if(!a[2].querySelector(`input[name="${n.name}"][value="nil"]`)){let m=document.createElement("input");m.type="radio",m.name=n.name,m.value="nil",a[2].appendChild(m)}a[2].querySelector(`input[name="${n.name}"][value="nil"]`).checked=!0}})}function h(e){if(!Array.from(e.options).some(s=>s.value==="nil")){let s=document.createElement("option");s.value="nil",s.textContent="",e.appendChild(s)}}function L(){let s=a[i].querySelectorAll("input[name], select[name], textarea[name]"),o={};s.forEach(n=>{if(n.name){if(n.type==="radio"&&!n.checked)return;o[n.name]=n.value.trim()}});let t=document.querySelector("input[type='email']");return t&&(o.email=t.value.trim()),console.log("Collected Step Data:",o),o}function b(){let e=a[i],s=e.querySelectorAll("[required]"),o=!0;return s.forEach(t=>{let n=t.closest(".form-input-holder").querySelector(".required-field");(t.type==="radio"?!e.querySelector(`input[name="${t.name}"]:checked`):!t.value.trim())?(n.classList.add("visible"),o=!1):n.classList.remove("visible"),t.addEventListener("input",()=>n.classList.remove("visible"))}),o}async function C(e){let s=`${S}?email=${encodeURIComponent(e)}`;try{let o=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await o.json();return console.log("GET Response Status:",o.status),console.log("GET Response Body:",t),t.contactExists===!0?(console.log("Contact exists (contactExists: true)."),!0):t.contactExists===!1?(console.log("Contact does not exist (contactExists: false)."),!1):(console.error("Unexpected response body or format:",t),!1)}catch(o){return console.error("Error during contact existence check:",o.message),!1}}async function u(e,s){let o=s?"POST":"PATCH",t={email:e.email,properties:{...e}};console.log("Sending Payload:",t);try{E(!0);let n=await fetch(S,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),c=await n.json();if(!n.ok)throw new Error(c.message||`Failed: ${n.statusText}`);return console.log(`${o} Successful:`,c),c}catch(n){throw console.error("Error submitting data:",n.message),n}finally{E(!1)}}function w(){let e=a[0].querySelector("input[type='email']");r.forEach(s=>s.classList.add("remove")),e.addEventListener("input",()=>{let o=e.value.trim().split("@")[1]?.toLowerCase();o&&k.includes(o)?(l=!1,r.forEach(t=>t.classList.remove("remove")),y.forEach(t=>t.classList.add("visible"))):o?(l=!0,y.forEach(t=>t.classList.remove("visible")),r.forEach(t=>t.classList.add("remove"))):(l=!1,r.forEach(t=>t.classList.add("remove")),y.forEach(t=>t.classList.add("remove"))),q(),d(i)})}function d(e){a.forEach((s,o)=>s.classList.toggle("hidden",o!==e)),g.classList.toggle("visible",e>0),e===1&&l?(p.style.display="none",f.classList.add("visible")):(p.style.display=e===a.length-1||e===1&&l?"none":"inline-block",f.classList.toggle("visible",e===a.length-1||e===1&&l))}p.addEventListener("click",async()=>{if(b()){let e=L();i===0&&!v?(console.log("Checking if contact exists for email:",e.email),await C(e.email)?(console.log("Contact exists, sending PATCH..."),await u(e,!1)):(console.log("Contact does not exist, sending POST..."),await u(e,!0),v=!0)):(console.log("Sending PATCH for step data..."),await u(e,!1)),i<a.length-1&&(i++,d(i))}}),f.addEventListener("click",async()=>{if(b()){let e=L();console.log("Submitting final data with PATCH..."),await u(e,!1),console.log("Form submitted successfully!")}}),g.addEventListener("click",()=>{i>0&&(i--,d(i))}),q(),d(i),w()});})();
